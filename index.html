<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Project 95</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: #018281;
      }
      /* Gallery grid inside folder modal */
      #galleryContainer {
        display: grid;
        grid-template-columns: repeat(
          auto-fill,
          minmax(150px, 1fr)
        ); /* bigger images */
        gap: 12px; /* more space between */
        margin-top: 10px;
        max-height: 300px;
        overflow-y: auto;
      }

      #galleryContainer img {
        width: 100%;
        border-radius: 8px;
        object-fit: cover;
        cursor: pointer;
        border: 1px solid #888;
      }
      /* Camera video styling */
      #cameraModal video {
        width: 100%;
        border-radius: 6px;
        background: black;
      }
    </style>
  </head>
  <body class="h-screen flex flex-col">
    <!-- Desktop -->
    <div class="flex-1 p-2 flex flex-col items-start space-y-5">
      <!-- Folder Icon (Profiles) -->
      <div
        class="flex flex-col items-center w-16 cursor-pointer select-none"
        ondblclick="my_modal_3.showModal()"
      >
        <img src="./Assets/folder.svg" alt="Folder" class="w-12 h-12 mb-1" />
        <span class="text-white text-sm text-center">Profiles</span>
      </div>

      <!-- Chrome Icon -->
      <div class="flex flex-col items-center w-16 cursor-pointer select-none">
        <img src="./Assets/chrome.svg" alt="Chrome" class="w-12 h-12 mb-1" />
        <span class="text-white text-sm text-center">Flappy Bird</span>
      </div>

      <!-- Camera Icon -->
      <div
        class="flex flex-col items-center w-16 cursor-pointer select-none"
        ondblclick="openCamera()"
        title="Open Camera"
      >
        <img src="./Assets/camera.svg" alt="Camera" class="w-12 h-12 mb-1" />
        <span class="text-white text-sm text-center">Camera</span>
      </div>

      <!-- Gallery Folder Icon -->
      <div
        class="flex flex-col items-center w-16 cursor-pointer select-none"
        ondblclick="openGallery()"
        title="Open Gallery"
      >
        <img
          src="./Assets/gallery.svg"
          alt="Gallery Folder"
          class="w-12 h-12 mb-1"
        />
        <span class="text-white text-sm text-center">Gallery</span>
      </div>
    </div>

    <!-- Taskbar -->
    <div class="h-10 bg-[#c0c0c0] text-white flex items-center px-3 relative">
      <button
        id="startBtn"
        class="bg-gray-300 text-black px-2 py-1 border border-gray-500 font-bold"
      >
        Start
      </button>
      <div class="flex-1"></div>
      <div id="clock" class="text-sm text-black">12:00 PM</div>
    </div>

    <!-- Start Menu Popup -->
    <div
      id="startMenu"
      class="hidden fixed bottom-10 left-2 w-48 bg-[#c0c0c0] border border-gray-600 shadow-lg"
    >
      <ul class="flex flex-col">
        <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer">
          Programs
        </li>
        <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer">
          Documents
        </li>
        <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer">
          Settings
        </li>
        <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer">
          Find
        </li>
        <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer">
          Run...
        </li>
        <li
          class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer border-t border-gray-400"
        >
          Shut Down...
        </li>
      </ul>
    </div>

    <!-- Folder Modal -->
    <dialog id="my_modal_3" class="modal">
      <div class="modal-box border border-gray-600 bg-gray-200 relative">
        <form method="dialog">
          <button
            class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
          >
            ✕
          </button>
        </form>
        <h3 class="text-lg font-bold mb-2">My Folder</h3>
        <p>This is the folder's content.</p>
      </div>
    </dialog>

    <!-- Camera Modal -->
    <dialog id="cameraModal" class="modal max-w-md w-full">
      <div
        class="modal-box border border-gray-600 bg-gray-200 p-4 flex flex-col items-center relative"
      >
        <video autoplay playsinline></video>
        <div class="mt-4 space-x-3">
          <button
            id="captureBtn"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
          >
            Capture
          </button>
          <button
            id="closeCameraBtn"
            class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
          >
            Close
          </button>
        </div>
        <p id="cameraStatus" class="mt-3 text-sm text-center"></p>
      </div>
    </dialog>

    <!-- Gallery Modal -->
    <dialog id="galleryModal" class="modal max-w-lg w-full">
      <div class="modal-box border border-gray-600 bg-gray-200 p-4 relative">
        <form method="dialog">
          <button
            class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
          >
            ✕
          </button>
        </form>
        <h3 class="text-lg font-bold mb-2">Photo Gallery</h3>
        <div id="galleryContainer">
          <!-- Images will be inserted here -->
        </div>
      </div>
    </dialog>

    <script>
      // Folder modal close on backdrop click
      document
        .getElementById("my_modal_3")
        .addEventListener("click", function (e) {
          const dialogDimensions = this.getBoundingClientRect();
          if (
            e.clientX < dialogDimensions.left ||
            e.clientX > dialogDimensions.right ||
            e.clientY < dialogDimensions.top ||
            e.clientY > dialogDimensions.bottom
          ) {
            this.close();
          }
        });

      // Start Menu toggle
      const startBtn = document.getElementById("startBtn");
      const startMenu = document.getElementById("startMenu");

      startBtn.addEventListener("click", () => {
        startMenu.classList.toggle("hidden");
      });

      // Hide start menu if clicking outside
      document.addEventListener("click", (e) => {
        if (!startMenu.contains(e.target) && !startBtn.contains(e.target)) {
          startMenu.classList.add("hidden");
        }
      });

      // Clock
      function updateClock() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes();
        const ampm = hours >= 12 ? "PM" : "AM";

        hours = hours % 12;
        if (hours === 0) hours = 12;

        const minutesStr = minutes < 10 ? "0" + minutes : minutes;
        const timeStr = `${hours}:${minutesStr} ${ampm}`;

        document.getElementById("clock").textContent = timeStr;
      }

      updateClock();
      setInterval(updateClock, 1000);

      // Camera logic
      const cameraModal = document.getElementById("cameraModal");
      const video = cameraModal.querySelector("video");
      const captureBtn = document.getElementById("captureBtn");
      const closeCameraBtn = document.getElementById("closeCameraBtn");
      const cameraStatus = document.getElementById("cameraStatus");
      let stream;

      async function openCamera() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: true });
          video.srcObject = stream;
          cameraModal.showModal();
          cameraStatus.textContent = "";
        } catch (err) {
          alert("Cannot access camera: " + err.message);
        }
      }

      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          stream = null;
        }
      }

      closeCameraBtn.addEventListener("click", () => {
        stopCamera();
        cameraModal.close();
      });

      captureBtn.addEventListener("click", () => {
        cameraStatus.textContent = "Capturing photo...";
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Convert canvas to Base64 data URL (JPEG)
        const dataUrl = canvas.toDataURL("image/jpeg", 0.9);

        // Save to localStorage
        savePhotoDataUrl(dataUrl);

        cameraStatus.textContent = "Photo saved locally!";
        renderGalleryInModal();
      });

      // Save Base64 photo strings in localStorage
      function savePhotoDataUrl(dataUrl) {
        let photos = JSON.parse(localStorage.getItem("photos") || "[]");
        photos.unshift(dataUrl);
        localStorage.setItem("photos", JSON.stringify(photos));
      }

      // Open Gallery modal and render gallery
      function openGallery() {
        renderGalleryInModal();
        galleryModal.showModal();
      }

      // Render gallery images inside gallery modal
      function renderGalleryInModal() {
        const galleryContainer = document.getElementById("galleryContainer");
        let photos = JSON.parse(localStorage.getItem("photos") || "[]");

        if (photos.length === 0) {
          galleryContainer.innerHTML =
            "<p>No photos yet. Take some with the camera!</p>";
          return;
        }

        galleryContainer.innerHTML = photos
          .map(
            (dataUrl, i) =>
              `<img src="${dataUrl}" alt="Photo ${i + 1}" title="Photo ${
                i + 1
              }" />`
          )
          .join("");
      }

      // Gallery modal close on backdrop click
      const galleryModal = document.getElementById("galleryModal");
      galleryModal.addEventListener("click", function (e) {
        const dialogDimensions = this.getBoundingClientRect();
        if (
          e.clientX < dialogDimensions.left ||
          e.clientX > dialogDimensions.right ||
          e.clientY < dialogDimensions.top ||
          e.clientY > dialogDimensions.bottom
        ) {
          this.close();
        }
      });

      // Folder modal backdrop close handled already
    </script>
  </body>
</html>
